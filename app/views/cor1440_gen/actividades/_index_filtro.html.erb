<%- model_class = Cor1440Gen::Actividad -%>
<%- 
  def self.poromision(s)
    params.nil? ? '' : (params[:filtro].nil? ? '' : params[:filtro][s])
  end 
-%>
<tr>
  <% @enctabla.each do |c| %>
    <th>
      <% case c %>
      <% when @actividades.human_attribute_name('id') %>
        <%= f.input 'buscodigo', 
          label: false,
          input_html: {
            value: poromision(:buscodigo), 
            maxlength: 10, 
            size: 6,
            "data-enviarautomatico" => "", 
            "placeholder" => model_class.human_attribute_name(:id) 
          } %>
      <% when @actividades.human_attribute_name('fecha') %>
        <%= f.input 'fechaini', 
          label: false,
          input_html: {
            value: poromision(:fechaini), 
            maxlength: 10, 
            size: 10,
            "data-behaviour" => "datepicker", 
            "data-enviarautomatico" => "" 
          } %>
        - <%= f.input 'fechafin', 
          label: false,
          input_html: {
            value: poromision(:fechafin), 
            maxlength: 10, 
            size: 10,
            "data-behaviour" => "datepicker", 
            "data-enviarautomatico" => "" } 
          %>
      <% when @actividades.human_attribute_name('oficina') %>
        <%= f.input "busoficina", 
          label: false,
          collection: Sip::Oficina.habilitados, 
          value_method: :id, 
          label_method: :nombre,
          selected: poromision(:busoficina),
          include_blank: true, 
          input_html: { 
            "data-enviarautomatico" => "", 
            style: "width: 10em" 
          } %>
      <% when @actividades.human_attribute_name('responsable') %>
        <% ord = ::Usuario.column_names.include?('nombres') ? 
          'nombres' : 'nombre' %>
        <% met = ord == 'nombres' ? 
          lambda {|t| t.nombres + ' ' + t.apellidos } : ord.to_sym %>
        <%= f.input "busresponsable", 
          label: false,
          collection: ::Usuario.order("LOWER(#{ord})"), 
          value_method: :id, 
          label_method: met,
          selected: poromision(:busresponsable),
          include_blank: true, 
          input_html: { 
            include_blank: true, 
            "data-enviarautomatico" => "", style: "width: 10em" 
          } %>
      <% when @actividades.human_attribute_name('nombre') %>
        <%= f.input 'busnombre', 
          label: false,
          input_html: {
            value: poromision(:busnombre),
            maxlength: 10, 
            size: 12,
            "data-enviarautomatico" => "", 
            "placeholder" => model_class.human_attribute_name(:nombre) 
          } %>
      <% when @actividades.human_attribute_name('departamento') %>
        <%= f.input 'busdepartamento', 
          label: false,
          collection: Sip::Departamento.habilitados.where(id_pais: 170),
          value_method: :id,
          label_method: :nombre,
          selected: poromision(:busdepartamento),
          include_blank: true,
          input_html: {
            "data-enviarautomatico" => "", 
            style: "width: 10em" 
          } %>
      <% when @actividades.human_attribute_name('actividadtipo') %>
        <%= f.input "busactividadtipo", 
          label: false,
          collection: Cor1440Gen::Actividadtipo.habilitados, 
          value_method: :id, 
          label_method: :nombre, 
          selected: poromision(:busactividadtipo),
          include_blank: true,
          input_html: { 
            "data-enviarautomatico" => "", 
            style: "width: 10em" 
          } %>
      <% when @actividades.human_attribute_name('proyectos') %>
        <%= f.input "busproyecto", 
          label: false,
          collection: Cor1440Gen::Proyecto.habilitados, 
          value_method: :id, 
          label_method: :nombre, 
          selected: poromision(:busproyecto), 
          include_blank: true,
          input_html: {
            "data-enviarautomatico" => "", 
            style: "width: 10em" 
          } %>
      <% when @actividades.human_attribute_name('actividadareas') %>
        <%= f.input "busarea", 
          label: false,
          collection: Cor1440Gen::Actividadarea.habilitados, 
          value_method: :id, 
          label_method: :nombre, 
          selected: poromision(:busarea), 
          include_blank: true,
          input_html: {
            "data-enviarautomatico" => "", 
            style: "width: 10em" 
          } %>
      <% when @actividades.human_attribute_name('proyectosfinancieros')%>
        <% fac = Time.now.strftime('%Y-%m-%d') 
           pf1 = Cor1440Gen::Proyectofinanciero.where(
             'fechainicio <= ? AND ? <= fechacierre', fac, fac)
           pf2 = Cor1440Gen::Proyectofinanciero.where(
             '? < fechainicio OR fechacierre < ?', fac, fac)
           epf = nil
           if (pf1.count > 0)
             epf = pf1.take
           elsif pf2.count > 0
             epf = pf2.take
           end
           lpf = []
           if epf
             pf1 =epf.filtra_acceso(current_usuario, pf1).order(:nombre)
             pf2 =epf.filtra_acceso(current_usuario, pf2).order(:nombre)
             lpf1 = pf1.map { |r| [r.nombre, r.id] } 
             lpf2 = pf2.map { |r| [r.nombre, r.id] } 
             lpf = lpf1 + lpf2
           end %> 
        <%= f.input "busproyectofinanciero", 
          label: false,
          collection: lpf,
          include_blank: true,
          selected: poromision(:busproyectofinanciero), 
          input_html: {
            "data-enviarautomatico" => "", 
            style: "width: 10em" 
          } %>
      <% when @actividades.human_attribute_name('objetivo') %>
        <%= f.input 'busobjetivo', 
          label: false,
          input_html: { 
            value: poromision(:busobjetivo), 
            maxlength: 10, 
            size: 12,
            "data-enviarautomatico" => "", 
            "placeholder" => model_class.human_attribute_name(:objetivo) 
          } %>
      <% when @actividades.human_attribute_name('resultado') %>
        <%= f.input 'busresultado', 
          label: false,
          input_html: { 
            value: poromision(:busresultado), 
            maxlength: 10, 
            size: 12,
            "data-enviarautomatico" => "", 
            "placeholder" => model_class.human_attribute_name(:resultado) 
          } %>
      <% when @actividades.human_attribute_name('contexto') %>
        <%= f.input 'buscontexto', 
          label: false,
          input_html: { 
            value: poromision(:buscontexto), 
            maxlength: 10, 
            size: 12,
            "data-enviarautomatico" => "", 
            "placeholder" => model_class.human_attribute_name(:contexto) 
          } %>
      <% end %>
    </th>
  <% end %>

  <th><!-- Anexos --></th>

  <th>
    <%= render partial: 'index_filtro_controles', locals: {f: f} %>
  </th>

</tr>
