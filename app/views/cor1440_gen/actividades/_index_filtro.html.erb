<%- model_class = Cor1440Gen::Actividad -%>
<%- 
  def self.poromision(s)
    params.nil? ? '' : (params[:filtro].nil? ? '' : params[:filtro][s])
  end 
-%>
<tr>
  <% @enctabla.each do |c| %>
    <th>
      <% case c %>
      <% when @actividades.human_attribute_name('id') %>
        <%= f.input 'buscodigo', 
          label: false,
          input_html: {
            value: poromision(:buscodigo), 
            maxlength: 10, 
            size: 6,
            "data-enviarautomatico" => "", 
            "placeholder" => model_class.human_attribute_name(:id) 
          }
        %>
      <% when @actividades.human_attribute_name('fecha') %>
        <%= f.input 'fechaini', 
          label: false,
          input_html: {
            value: poromision(:fechaini), 
            maxlength: 10, 
            size: 10,
            "data-behaviour" => "datepicker", 
            "data-enviarautomatico" => "" 
          }
        %>
        -
        <%= f.input 'fechafin', 
          label: false,
          input_html: {
            value: poromision(:fechafin), 
            maxlength: 10, 
            size: 10,
            "data-behaviour" => "datepicker", 
            "data-enviarautomatico" => "" 
          }
        %>
      <% when @actividades.human_attribute_name('oficina') %>
        <%= f.input "busoficina", 
          label: false,
          collection: Sip::Oficina.habilitados, 
          value_method: :id, 
          label_method: :nombre,
          selected: poromision(:busoficina),
          include_blank: true, 
          input_html: { 
            "data-enviarautomatico" => "", 
            style: "width: 10em" 
          } 
        %>
      <% when @actividades.human_attribute_name('responsable') %>
        <%= f.input "busresponsable", 
          label: false,
          collection: ::Usuario.order('LOWER(nombre)'), 
          value_method: :id, 
          label_method: :nombre,
          selected: poromision(:busresponsable),
          include_blank: true, 
          input_html: { 
            include_blank: true, 
            "data-enviarautomatico" => "", style: "width: 10em" 
          }   
        %>
      <% when @actividades.human_attribute_name('nombre') %>
        <%= f.input 'busnombre', 
          label: false,
          input_html: {
            value: poromision(:busnombre),
            maxlength: 10, 
            size: 12,
            "data-enviarautomatico" => "", 
            "placeholder" => model_class.human_attribute_name(:nombre) 
          }
        %>
      <% when @actividades.human_attribute_name('actividadtipos') %>
        <%= f.input "bustipo", 
          label: false,
          collection: Cor1440Gen::Actividadtipo.habilitados, 
          value_method: :id, 
          label_method: :nombre, 
          selected: poromision(:bustipo),
          include_blank: true,
          input_html: { 
            "data-enviarautomatico" => "", 
            style: "width: 10em" 
          } 
        %>
      <% when @actividades.human_attribute_name('proyectos') %>
        <%= f.input "busproyecto", 
          label: false,
          collection: Cor1440Gen::Proyecto.habilitados, 
          value_method: :id, 
          label_method: :nombre, 
          selected: poromision(:busproyecto), 
          include_blank: true,
          input_html: {
            "data-enviarautomatico" => "", 
            style: "width: 10em" 
          } 
        %>
      <% when @actividades.human_attribute_name('actividadareas') %>
        <%= f.input "busarea", 
          label: false,
          collection: Cor1440Gen::Actividadarea.habilitados, 
          value_method: :id, 
          label_method: :nombre, 
          selected: poromision(:busarea), 
          include_blank: true,
          input_html: {
            "data-enviarautomatico" => "", 
            style: "width: 10em" 
          } 
        %>
      <% when @actividades.human_attribute_name('proyectosfinancieros')%>
        <% fac = Time.now.strftime('%Y-%m-%d') %>
        <% lpf1 = Cor1440Gen::Proyectofinanciero.where(
          'fechainicio <= ? AND ? <= fechacierre', fac, fac).
          order(:nombre).map { |r| [r.nombre, r.id] } 
        %>
        <% lpf2 = Cor1440Gen::Proyectofinanciero.where(
          '? < fechainicio OR fechacierre < ?', fac, fac).
          order(:nombre).map { |r| [r.nombre, r.id] }
        %>
        <% lpf = lpf1 + lpf2 %> 
        <%= f.input "busproyectofinanciero", 
          label: false,
          collection: lpf,
          include_blank: true,
          input_html: {
            "data-enviarautomatico" => "", 
            style: "width: 10em" 
          } 
        %>
      <% when @actividades.human_attribute_name('objetivo') %>
        <%= f.input 'busobjetivo', 
          label: false,
          input_html: { 
            value: poromision(:busobjetivo), 
            maxlength: 10, 
            size: 12,
            "data-enviarautomatico" => "", 
            "placeholder" => model_class.human_attribute_name(:objetivo) 
          }
        %>
    <% end %>
    </th>
  <% end %>

  <th><!-- Anexos --></th>

  <th>
    <%= render partial: 'index_filtro_controles', locals: {f: f} %>
  </th>

</tr>
