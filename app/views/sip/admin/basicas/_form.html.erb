<%= simple_form_for @basica, 
  url: @basica.id.nil? ? (admin_basicas_path(@basica)) : 
  admin_basica_path(@basica), defaults: { input_html: { class: 'span10' } } do |f| %>
    <% atributos_form.each do |atr|  %>
      <% puts atr %>
      <% if @basica.class.columns_hash[atr] && 
           @basica.class.columns_hash[atr].type == :date then %>
        <%= f.input atr.to_sym,
          :input_html => { "data-behaviour" => "datepicker"}, 
          :as => :string 
        %>
      <% elsif atr == "id_pais" %>
        <%= f.association :pais,
          collection: Sip::Pais.habilitados,
          label: "PaÃ­s",
          label_method: :nombre,
          value_method: :id 
        %>
      <% elsif atr == "id_departamento" %>
        <%= f.association :departamento,
          collection: (Sip::Departamento.habilitados), #.where(id_pais: f.object.departamento.id_pais)),
          label: "Departamento",
          label_method: lambda {|t| t.nombre + " (" + 
            Sip::Pais.find(t.id_pais).nombre + ")"},
            value_method: :id 
        %>
      <% elsif atr == "id_municipio" %>
        <%= f.association :municipio,
          collection: (Sip::Municipio.habilitados), #.where( id_departamento: f.object.id_departamento)),
          label: "Municipio",
          label_method: lambda {|t| 
            dep = Sip::Departamento.find(t.id_departamento)
            pais = Sip::Pais.find(dep.id_pais)
            t.nombre + " (" + 
              dep.nombre + " / " +
              pais.nombre + ")"
          },
          value_method: :id 
        %>
      <% elsif atr == "id_tclase" %>
        <%= f.association :tclase,
          collection: (Sip::Tclase.habilitados),
          label: "Tipo de Clase",
          label_method: :nombre,
          value_method: :id 
        %>
      <% elsif atr == {:proyecto_ids => [] } || atr == "proyecto_id" %>
        <%= f.association :proyecto,
          collection: (Cor1440Gen::Proyecto.habilitados),
          label: "Proyecto",
          label_method: :nombre,
          value_method: :id 
        %>
      <% elsif atr == "financiador_id" %>
        <%= f.association :financiador,
          collection: (Cor1440Gen::Financiador.habilitados),
          label: "Financiador",
          label_method: :nombre,
          value_method: :id 
        %>
      <% elsif atr == "responsable_id" %>
        <%= f.association :responsable,
          collection: Usuario.where(fechadeshabilitacion: nil),
          label: "Responsable",
          label_method: lambda {|t|
            r = t.nusuario
            if t.nombre
              r += ' - ' + t.nombre
            end
            return r },
              value_method: :id 
        %>
      <% else %>
        <%= f.input atr.to_sym %>
    <% end %>
  <% end %>
  <div class="form-actions">
    <%= f.button :submit, (f.object.new_record? ? 'Crear' : 'Actualizar'), 
      :class => 'btn-primary' %>
    <%= link_to t('.cancel', :default => t("helpers.links.cancel")),
      admin_basicas_path(@basica), :class => 'btn' 
    %>
  </div>
<% end %>
